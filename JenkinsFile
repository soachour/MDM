pipeline {
  agent any

  stages {
    stage('Recover Code from BitPocket') {
      steps {
        input {
          message "Specify the branch to recover code from BitPocket"
          parameters {
            string(name: 'BRANCH', defaultValue: 'master', description: 'Enter the branch name')
          }
        }
        git branch: "${params.BRANCH}", url: '<bitpocket-repo-url>'
      }
    }

    stage('Run Tests') {
      steps {
        sh 'node --version'
        sh 'node -v'
        sh 'npm install'
        
        dir('path/to/your/test/folder') { // Replace with the actual folder path
          script {
            def testResult = sh script: 'node your-test-script.js', returnStatus: true
            if (testResult == 0) {
              currentBuild.result = 'SUCCESS'
            } else {
              currentBuild.result = 'FAILURE'
            }
          }
        }
      }
    }

    stage('Send Code via SFTP') {
      when {
        expression {
          return currentBuild.result == 'SUCCESS'
        }
      }
      steps {
        // SFTP configuration and steps
      }
    }
  }
}
